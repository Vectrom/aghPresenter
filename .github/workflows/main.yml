name: BuildAndPack

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  # Win:
  #   runs-on: windows-latest
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v2
  #       with:
  #         submodules: true

  #     - name: Build
  #       run: |
  #         cmake -E remove_directory build
  #         cmake -E make_directory build
  #         cd build
  #         cmake .. -G "Visual Studio 16 2019"
  #         cmake --build . --config Release

  #     - name: Pack
  #       run: |
  #         cd build
  #         cpack

  #     - name: Upload
  #       uses: actions/upload-artifact@v2
  #       with:
  #         name: AGHPresenter-Win64
  #         path: build/AGHPresenter-*.*-*.zip

  Mac:
    runs-on: macos-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          submodules: true

      - name: Build
        run: |
          cmake -E remove_directory build
          cmake -E make_directory build
          cd build
          cmake .. -G "Xcode"
          cmake --build . --config Release

      - name: Pack
        run: |
          cd build
          cpack

      - name: Upload
        uses: actions/upload-artifact@v2
        with:
          name: AGHPresenter-MacOS
          path: build/AGHPresenter-*.*-*.zip

  Lnx:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          submodules: true

      - name: Build
        run: |
          cmake -E remove_directory build
          cmake -E make_directory build
          cd build
          cmake ..
          cmake --build . --config Release

      - name: Pack
        run: |
          cd build
          cpack

      - name: Upload
        uses: actions/upload-artifact@v2
        with:
          name: AGHPresenter-Linux
          path: build/AGHPresenter-*.*-*.zip

